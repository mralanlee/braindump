# VPC
A virtual data center in the cloud.

- Lets you provision an isolated section of AWS cloud
- Launch AWS resources in a virtual network you define.
- Complete control over virtual networking environment including:
  - Selection of IP Address Range
  - Creation of subnets
  - Configuration of route tables and network gateways
- Customize networking of your Amazon VPC
  - Create a public-facing subnet for webservers that access the internet
  - place your backend system such as db, or app servers in a private facing subnet with no internet access
  - Leverage multiple layers of security, such as security groups and Network access control lists to help control access to EC2 instances in each subnet.
- Can create a Hardware VPN connection corporate datacenter and your VPC and leverage AWS as an extension of datacenter.
- Can have multiple VPCs in a region
- 1 subnet = 1 AZ
- Security groups are stateful; Network Acccess Control Lists are stateless
- No transitive peering
- **Allowed 5 VPCs in each AWS region by default**
- Only 1 Internet Gateway to Custom VPC
- You have a VPC with both public and private subnets. You have 3 EC2 instances that have been deployed in to the public subnet and each has internet access. You deploy a 4th instance using the same AMI and this instance does not have internet access. What could be the cause of this? **Instance needs either Elastic IP Address/Public IP address assigned to it** 

Internet Gateway/Virtual Private Gateway -> Router -> Router Table -> Netwrok ACL -> Route to respecting Security Group (under one VPC)

## Internal IP Ranges (from AWS)
- 10.0.0.0 - 10.255.255.255 (10/8 prefix)
- 172.16.0.0 - 172.31.255.255 (172.16/12 prefix)
- 192.168.0.0 - 192.168.255.255(192.168/16 prefix)

## Features
- Launch instances into a subnet of choosing
- Assign custom IP address ranges in each subnet
- Configure route tables between subnets
- Create internet gateway and attach it to VPC
- Better security control over AWS resources
- Instance security groups (private subnets)
- Subnet network access control lists

Default VPC vs Custom VPC
- Default VPC is user friendly, allowing you to immediately deploy instances
- All subnets in default VPC have a route out to the internet
- Each EC2 instance has both a public and private IP address

## VPC Peering
- Connect one VPC to another with a direct network route using private IP addresses.
- Instance behave as they were on the same private network
- Can peer VPC's with other AWS accounts
- In a star configuration, $example$: 1 central VPC with 4 others. VPC A (central) can talk to VPC B, C, D, and E. B cannot talk to C, D, E. No transitive peering.

## Subnets
- The first four IP Addresses and the last IP Addresses in each subnet CIDR block are not available for use
- App Load Balancers (ALB) need at least 2 public subnets in order to deploy

## VPC Flow Logs
- Features that enables you to capture information about the IP traffic going to and from the network interfaces in your VPC
- Flog logs are stored using CloudWatch Logs
- After created, view and review its data in Amazon CloudWatch

Can be created at 3 different levels:
- VPC
- Subnet
- Network Interface Level

## Endpoints
- In VPC Dashboard, go to Endpoints
- Create an Endpoint
  - Interface Endpoint
    - Elastic network interface that attaches to EC2 instances, destination for traffic
  - Gateway
    - Not on a single interface or ENI, highly available
- Configure Route Tables
- Set Policy
  - Full Access

### Exam Tips
- Cannot enable flow logs for VPCs that are peered with your VPC unless the peer VPC is in your account
- Cannot tag a flow log
- Cannot change its configuration after created
- Not all IP trafic is monitored, here are some cases:
  - Traffic generated by instances when they contact Amazon DNS server
    - If you use your own DNS server, all traffic to that server is logged
  - Traffic generated by a windows instance for Amazon Windows License Activation
  - Traffic to and from 169.254.169.254 for instance metadata.
  - DHCP traffic
  - Traffic to the reserved IP adress for the default VPC router.
